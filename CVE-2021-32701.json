{
  "id": "CVE-2021-32701",
  "sourceIdentifier": "security-advisories@github.com",
  "published": "2021-06-22T20:15:08.727",
  "lastModified": "2024-11-21T06:07:33.667",
  "vulnStatus": "Modified",
  "cveTags": [],
  "descriptions": [
    {
      "lang": "en",
      "value": "ORY Oathkeeper is an Identity & Access Proxy (IAP) and Access Control Decision API that authorizes HTTP requests based on sets of Access Rules. When you make a request to an endpoint that requires the scope `foo` using an access token granted with that `foo` scope, introspection will be valid and that token will be cached. The problem comes when a second requests to an endpoint that requires the scope `bar` is made before the cache has expired. Whether the token is granted or not to the `bar` scope, introspection will be valid. A patch will be released with `v0.38.12-beta.1`. Per default, caching is disabled for the `oauth2_introspection` authenticator. When caching is disabled, this vulnerability does not exist. The cache is checked in [`func (a *AuthenticatorOAuth2Introspection) Authenticate(...)`](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L152). From [`tokenFromCache()`](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L97) it seems that it only validates the token expiration date, but ignores whether the token has or not the proper scopes. The vulnerability was introduced in PR #424. During review, we failed to require appropriate test coverage by the submitter which is the primary reason that the vulnerability passed the review process."
    },
    {
      "lang": "es",
      "value": "ORY Oathkeeper es un Proxy de Identidad y Acceso (IAP) y una API de Decisión de Control de Acceso que autoriza peticiones HTTP basadas en conjuntos de Reglas de Acceso. Cuando se realiza una petición a un endpoint que requiere el ámbito \"foo\" usando un token de acceso concedido con ese ámbito \"foo\", la introspección será válida y ese token se almacenará en caché. El problema viene cuando se realiza una segunda petición a un endpoint que requiere el ámbito \"bar\" antes de que la caché haya expirado. Tanto si se concede el token como si no al ámbito \"bar\", la introspección será válida. Se publicará un parche con la versión \"v0.38.12-beta.1\". Por defecto, el almacenamiento en caché está desactivado para el autenticador \"oauth2_introspection\". Cuando el almacenamiento en caché está deshabilitado, esta vulnerabilidad no existe. La caché es comprobada en [\"func (a *AuthenticatorOAuth2Introspection) Authenticate(...)\"](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L152). De [\"tokenFromCache()\"](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L97) parece que sólo comprueba la fecha de caducidad del token, pero ignora si el token tiene o no los ámbitos adecuados. La vulnerabilidad fue introducida en PR #424. Durante la revisión, fallamos en requerir una cobertura de pruebas apropiada por parte del remitente, lo cual es la razón principal por la que la vulnerabilidad pasó el proceso de revisión"
    }
  ],
  "metrics": {
    "cvssMetricV31": [
      {
        "source": "security-advisories@github.com",
        "type": "Secondary",
        "cvssData": {
          "version": "3.1",
          "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
          "baseScore": 7.5,
          "baseSeverity": "HIGH",
          "attackVector": "NETWORK",
          "attackComplexity": "LOW",
          "privilegesRequired": "NONE",
          "userInteraction": "NONE",
          "scope": "UNCHANGED",
          "confidentialityImpact": "HIGH",
          "integrityImpact": "NONE",
          "availabilityImpact": "NONE"
        },
        "exploitabilityScore": 3.9,
        "impactScore": 3.6
      },
      {
        "source": "nvd@nist.gov",
        "type": "Primary",
        "cvssData": {
          "version": "3.1",
          "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
          "baseScore": 7.5,
          "baseSeverity": "HIGH",
          "attackVector": "NETWORK",
          "attackComplexity": "LOW",
          "privilegesRequired": "NONE",
          "userInteraction": "NONE",
          "scope": "UNCHANGED",
          "confidentialityImpact": "HIGH",
          "integrityImpact": "NONE",
          "availabilityImpact": "NONE"
        },
        "exploitabilityScore": 3.9,
        "impactScore": 3.6
      }
    ],
    "cvssMetricV2": [
      {
        "source": "nvd@nist.gov",
        "type": "Primary",
        "cvssData": {
          "version": "2.0",
          "vectorString": "AV:N/AC:M/Au:N/C:P/I:N/A:N",
          "baseScore": 4.3,
          "accessVector": "NETWORK",
          "accessComplexity": "MEDIUM",
          "authentication": "NONE",
          "confidentialityImpact": "PARTIAL",
          "integrityImpact": "NONE",
          "availabilityImpact": "NONE"
        },
        "baseSeverity": "MEDIUM",
        "exploitabilityScore": 8.6,
        "impactScore": 2.9,
        "acInsufInfo": false,
        "obtainAllPrivilege": false,
        "obtainUserPrivilege": false,
        "obtainOtherPrivilege": false,
        "userInteractionRequired": false
      }
    ]
  },
  "weaknesses": [
    {
      "source": "security-advisories@github.com",
      "type": "Primary",
      "description": [
        {
          "lang": "en",
          "value": "CWE-863"
        }
      ]
    }
  ],
  "configurations": [
    {
      "nodes": [
        {
          "operator": "OR",
          "negate": false,
          "cpeMatch": [
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.0:beta2:*:*:*:*:*:*",
              "matchCriteriaId": "DC847085-1357-48B3-A809-78F964DE5469"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.1:beta2:*:*:*:*:*:*",
              "matchCriteriaId": "8EE6201C-CC5D-4202-A0E1-6170ECD0A6A9"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.2:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "C0BA2A9E-02E3-4F3B-BC57-139645995814"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.3:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "33B55094-713D-4DB0-948C-3A4BA060640C"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.4:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "A78FF290-4F7A-4386-8802-DFBAD0A32725"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.5:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "D212F091-4CC2-4E80-B68E-E77121F59FF3"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.6:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "524EFECB-F19D-4150-BAED-8303F12DC5D5"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.7:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "4E7BE228-BE08-479F-B2F7-0CD44751D425"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.8:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "23B6E7B2-8865-4B7E-BF31-69F5AD03A817"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.9:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "B790D997-23B1-4509-AE64-597F1BA287F0"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.10:beta2:*:*:*:*:*:*",
              "matchCriteriaId": "18DC4A21-2634-4ABE-8DCE-1CE7A056799A"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:a:ory:oathkeeper:0.38.11:beta1:*:*:*:*:*:*",
              "matchCriteriaId": "A130449A-B114-4422-ABBE-83DB35C9679C"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "url": "https://github.com/ory/oathkeeper/commit/1f9f625c1a49e134ae2299ee95b8cf158feec932",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ory/oathkeeper/pull/424",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ory/oathkeeper/security/advisories/GHSA-qvp4-rpmr-xwrr",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ory/oathkeeper/commit/1f9f625c1a49e134ae2299ee95b8cf158feec932",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ory/oathkeeper/pull/424",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ory/oathkeeper/security/advisories/GHSA-qvp4-rpmr-xwrr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ]
}