{
  "id": "CVE-2024-56770",
  "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
  "published": "2025-01-08T17:15:15.957",
  "lastModified": "2025-10-01T20:17:51.170",
  "vulnStatus": "Modified",
  "cveTags": [],
  "descriptions": [
    {
      "lang": "en",
      "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet/sched: netem: account for backlog updates from child qdisc\n\nIn general, 'qlen' of any classful qdisc should keep track of the\nnumber of packets that the qdisc itself and all of its children holds.\nIn case of netem, 'qlen' only accounts for the packets in its internal\ntfifo. When netem is used with a child qdisc, the child qdisc can use\n'qdisc_tree_reduce_backlog' to inform its parent, netem, about created\nor dropped SKBs. This function updates 'qlen' and the backlog statistics\nof netem, but netem does not account for changes made by a child qdisc.\n'qlen' then indicates the wrong number of packets in the tfifo.\nIf a child qdisc creates new SKBs during enqueue and informs its parent\nabout this, netem's 'qlen' value is increased. When netem dequeues the\nnewly created SKBs from the child, the 'qlen' in netem is not updated.\nIf 'qlen' reaches the configured sch->limit, the enqueue function stops\nworking, even though the tfifo is not full.\n\nReproduce the bug:\nEnsure that the sender machine has GSO enabled. Configure netem as root\nqdisc and tbf as its child on the outgoing interface of the machine\nas follows:\n$ tc qdisc add dev <oif> root handle 1: netem delay 100ms limit 100\n$ tc qdisc add dev <oif> parent 1:0 tbf rate 50Mbit burst 1542 latency 50ms\n\nSend bulk TCP traffic out via this interface, e.g., by running an iPerf3\nclient on the machine. Check the qdisc statistics:\n$ tc -s qdisc show dev <oif>\n\nStatistics after 10s of iPerf3 TCP test before the fix (note that\nnetem's backlog > limit, netem stopped accepting packets):\nqdisc netem 1: root refcnt 2 limit 1000 delay 100ms\n Sent 2767766 bytes 1848 pkt (dropped 652, overlimits 0 requeues 0)\n backlog 4294528236b 1155p requeues 0\nqdisc tbf 10: parent 1:1 rate 50Mbit burst 1537b lat 50ms\n Sent 2767766 bytes 1848 pkt (dropped 327, overlimits 7601 requeues 0)\n backlog 0b 0p requeues 0\n\nStatistics after the fix:\nqdisc netem 1: root refcnt 2 limit 1000 delay 100ms\n Sent 37766372 bytes 24974 pkt (dropped 9, overlimits 0 requeues 0)\n backlog 0b 0p requeues 0\nqdisc tbf 10: parent 1:1 rate 50Mbit burst 1537b lat 50ms\n Sent 37766372 bytes 24974 pkt (dropped 327, overlimits 96017 requeues 0)\n backlog 0b 0p requeues 0\n\ntbf segments the GSO SKBs (tbf_segment) and updates the netem's 'qlen'.\nThe interface fully stops transferring packets and \"locks\". In this case,\nthe child qdisc and tfifo are empty, but 'qlen' indicates the tfifo is at\nits limit and no more packets are accepted.\n\nThis patch adds a counter for the entries in the tfifo. Netem's 'qlen' is\nonly decreased when a packet is returned by its dequeue function, and not\nduring enqueuing into the child qdisc. External updates to 'qlen' are thus\naccounted for and only the behavior of the backlog statistics changes. As\nin other qdiscs, 'qlen' then keeps track of  how many packets are held in\nnetem and all of its children. As before, sch->limit remains as the\nmaximum number of packets in the tfifo. The same applies to netem's\nbacklog statistics."
    },
    {
      "lang": "es",
      "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: net/sched: netem: contabilizar las actualizaciones atrasadas de la qdisc secundaria En general, 'qlen' de cualquier qdisc con clase debe realizar un seguimiento de la cantidad de paquetes que la propia qdisc y todos sus hijos contienen. En el caso de netem, 'qlen' solo contabiliza los paquetes en su tfifo interno. Cuando netem se usa con una qdisc secundaria, la qdisc secundaria puede usar 'qdisc_tree_reduce_backlog' para informar a su padre, netem, sobre los SKB creados o descartados. Esta función actualiza 'qlen' y las estadísticas de atraso de netem, pero netem no contabiliza los cambios realizados por una qdisc secundaria. 'qlen' luego indica la cantidad incorrecta de paquetes en el tfifo. Si una qdisc secundaria crea nuevos SKB durante la puesta en cola e informa a su padre sobre esto, el valor 'qlen' de netem aumenta. Cuando netem saca de la cola los SKB recién creados del hijo, el 'qlen' en netem no se actualiza. Si 'qlen' alcanza el sch-&gt;limit configurado, la función de puesta en cola deja de funcionar, aunque el tfifo no esté lleno. Reproducir el error: Asegúrese de que la máquina remitente tenga GSO habilitado. Configure netem como qdisc raíz y tbf como su hijo en la interfaz de salida de la máquina de la siguiente manera: $ tc qdisc add dev  root handle 1: netem delay 100ms limit 100 $ tc qdisc add dev  parent 1:0 tbf rate 50Mbit burst 1542 latency 50ms Envíe tráfico TCP masivo a través de esta interfaz, por ejemplo, ejecutando un cliente iPerf3 en la máquina. Compruebe las estadísticas de qdisc: $ tc -s qdisc show dev  Estadísticas después de 10 s de prueba TCP de iPerf3 antes de la corrección (tenga en cuenta que el backlog de netem &gt; limit, netem dejó de aceptar paquetes): qdisc netem 1: root refcnt 2 limit 1000 delay 100ms Sent 2767766 bytes 1848 pkt (dropped 652, overlimits 0 requeues 0) backlog 4294528236b 1155p requeues 0 qdisc tbf 10: parent 1:1 rate 50Mbit burst 1537b lat 50ms Sent 2767766 bytes 1848 pkt (dropped 327, overlimits 7601 requeues 0) backlog 0b 0p requeues 0 Estadísticas después de la corrección: qdisc netem 1: root refcnt 2 limit 1000 delay 100ms Enviados 37766372 bytes 24974 pkt (derramados 9, sobrepasa los límites 0, pone en cola 0) backlog 0b 0p pone en cola 0 qdisc tbf 10: padre 1:1 tasa 50Mbit ráfaga 1537b lat 50ms Enviados 37766372 bytes 24974 pkt (derramados 327, sobrepasa los límites 96017, pone en cola 0) backlog 0b 0p pone en cola 0 tbf segmenta los SKB de GSO (tbf_segment) y actualiza el 'qlen' de netem. La interfaz deja de transferir paquetes por completo y se \"bloquea\". En este caso, la qdisc secundaria y la tfifo están vacías, pero 'qlen' indica que la tfifo está en su límite y no se aceptan más paquetes. Este parche agrega un contador para las entradas en la tfifo. La 'qlen' de Netem solo se reduce cuando la función de desencolado devuelve un paquete, y no durante la puesta en cola en la qdisc secundaria. De este modo, se tienen en cuenta las actualizaciones externas de 'qlen' y solo cambia el comportamiento de las estadísticas de la lista de espera. Como en otras qdisc, 'qlen' realiza un seguimiento de cuántos paquetes se mantienen en netem y en todas sus hijas. Como antes, sch-&gt;limit permanece como el número máximo de paquetes en la tfifo. Lo mismo se aplica a las estadísticas de la lista de espera de netem."
    }
  ],
  "metrics": {
    "cvssMetricV31": [
      {
        "source": "nvd@nist.gov",
        "type": "Primary",
        "cvssData": {
          "version": "3.1",
          "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
          "baseScore": 5.5,
          "baseSeverity": "MEDIUM",
          "attackVector": "LOCAL",
          "attackComplexity": "LOW",
          "privilegesRequired": "LOW",
          "userInteraction": "NONE",
          "scope": "UNCHANGED",
          "confidentialityImpact": "NONE",
          "integrityImpact": "NONE",
          "availabilityImpact": "HIGH"
        },
        "exploitabilityScore": 1.8,
        "impactScore": 3.6
      },
      {
        "source": "134c704f-9b21-4f2e-91b3-4a467353bcc0",
        "type": "Secondary",
        "cvssData": {
          "version": "3.1",
          "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
          "baseScore": 5.5,
          "baseSeverity": "MEDIUM",
          "attackVector": "LOCAL",
          "attackComplexity": "LOW",
          "privilegesRequired": "LOW",
          "userInteraction": "NONE",
          "scope": "UNCHANGED",
          "confidentialityImpact": "NONE",
          "integrityImpact": "NONE",
          "availabilityImpact": "HIGH"
        },
        "exploitabilityScore": 1.8,
        "impactScore": 3.6
      }
    ]
  },
  "weaknesses": [
    {
      "source": "nvd@nist.gov",
      "type": "Primary",
      "description": [
        {
          "lang": "en",
          "value": "NVD-CWE-noinfo"
        }
      ]
    }
  ],
  "configurations": [
    {
      "nodes": [
        {
          "operator": "OR",
          "negate": false,
          "cpeMatch": [
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "3.3",
              "versionEndExcluding": "5.4.288",
              "matchCriteriaId": "2BBFF06A-6037-47B4-A3CF-B6B0F51D3491"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "5.5",
              "versionEndExcluding": "5.10.232",
              "matchCriteriaId": "0B975945-2894-4433-BA59-0988B75B4C12"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "5.11",
              "versionEndExcluding": "5.15.175",
              "matchCriteriaId": "7A1F3620-6900-4852-9229-C3527377EBDA"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "5.16",
              "versionEndExcluding": "6.1.121",
              "matchCriteriaId": "D8DA16A0-9C6E-493E-90EE-309A34901477"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "6.2",
              "versionEndExcluding": "6.6.67",
              "matchCriteriaId": "BF4F2CD1-2CA6-4D6B-9B0C-57C3C4D6544A"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
              "versionStartIncluding": "6.7",
              "versionEndExcluding": "6.12.6",
              "matchCriteriaId": "0CB1A9BB-F95E-43DD-A2FD-147912FD91E5"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*",
              "matchCriteriaId": "62567B3C-6CEE-46D0-BC2E-B3717FBF7D13"
            },
            {
              "vulnerable": true,
              "criteria": "cpe:2.3:o:linux:linux_kernel:6.13:rc2:*:*:*:*:*:*",
              "matchCriteriaId": "5A073481-106D-4B15-B4C7-FB0213B8E1D4"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "url": "https://git.kernel.org/stable/c/10df49cfca73dfbbdb6c4150d859f7e8926ae427",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/216509dda290f6db92c816dd54b83c1df9da9e76",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/356078a5c55ec8d2061fcc009fb8599f5b0527f9",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/3824c5fad18eeb7abe0c4fc966f29959552dca3e",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/83c6ab12f08dcc09d4c5ac86fdb89736b28f1d31",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/c2047b0e216c8edce227d7c42f99ac2877dad0e4",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://git.kernel.org/stable/c/f8d4bc455047cf3903cd6f85f49978987dbb3027",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
      "tags": [
        "Patch"
      ]
    }
  ]
}